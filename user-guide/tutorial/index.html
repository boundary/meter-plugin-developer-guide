<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Overview - Meter Plugin Development</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Meter Plugin Development</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../getting-started/">Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../getting-started/prerequisites/">Prerequisites</a>
                        </li>
                    
                        <li >
                            <a href="../getting-started/plugin-contents/">Meter Plugin Contents</a>
                        </li>
                    
                        <li >
                            <a href="../getting-started/framework/">Framework</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li class="active">
                            <a href="./">Overview</a>
                        </li>
                    
                        <li >
                            <a href="define-metrics/">Define Metrics</a>
                        </li>
                    
                        <li >
                            <a href="create-manifest/">Create Manifest</a>
                        </li>
                    
                        <li >
                            <a href="create-manifest/">Add Icon</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../examples/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../examples/example-hello-world/">Hello World</a>
                        </li>
                    
                        <li >
                            <a href="../examples/example-hello-world2/">Hello World part deux</a>
                        </li>
                    
                        <li >
                            <a href="../examples/example-hello-world2/">Give It a Rest</a>
                        </li>
                    
                        <li >
                            <a href="../examples/example-hello-world2/">Meter and Me and the Plugin makes Three</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../troubleshooting/">Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../troubleshooting/common-issues/">Common Issues</a>
                        </li>
                    
                        <li >
                            <a href="../troubleshooting/tracing-measurement-flow/">Tracing Measurement Flow</a>
                        </li>
                    
                        <li >
                            <a href="../troubleshooting/tracing-tools/">Tracing Tools</a>
                        </li>
                    
                        <li >
                            <a href="../troubleshooting/plugin-sends-measurement/">Meter Plugin Writes Measurement</a>
                        </li>
                    
                        <li >
                            <a href="../troubleshooting/plugin-reads-measurement/">Plugin Manager Reads Meter Plugin</a>
                        </li>
                    
                        <li >
                            <a href="../troubleshooting/plugin-writes-to-meter/">Plugin Manager Writes To Meter</a>
                        </li>
                    
                        <li >
                            <a href="../troubleshooting/meter-receives-rpc-call/">Meter Receives RPC Call</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../reference/deploying/">Deploying</a>
                        </li>
                    
                        <li >
                            <a href="../reference/plugin-dashboards/">Dashboards</a>
                        </li>
                    
                        <li >
                            <a href="../reference/manifest/">Manifest</a>
                        </li>
                    
                        <li >
                            <a href="../reference/metrics/">Metrics</a>
                        </li>
                    
                        <li >
                            <a href="../reference/protocol/">Protocol</a>
                        </li>
                    
                        <li >
                            <a href="../reference/measurements/">Measurements</a>
                        </li>
                    
                        <li >
                            <a href="../reference/events/">Events</a>
                        </li>
                    
                        <li >
                            <a href="../reference/documentation/">Documentation</a>
                        </li>
                    
                        <li >
                            <a href="../reference/parameters/">Parameters</a>
                        </li>
                    
                        <li >
                            <a href="../reference/production/">Production</a>
                        </li>
                    
                        <li >
                            <a href="../reference/github-account/">GitHub Account</a>
                        </li>
                    
                        <li >
                            <a href="../reference/github-repository/">GitHub Repository</a>
                        </li>
                    
                        <li >
                            <a href="../reference/git-tools/">Git Tools</a>
                        </li>
                    
                        <li >
                            <a href="../reference/tools/">Tools</a>
                        </li>
                    
                        <li >
                            <a href="../reference/testing/">Testing</a>
                        </li>
                    
                        <li >
                            <a href="../reference/checklist/">Check List</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../getting-started/framework/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="define-metrics/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#overview">Overview</a></li>
        
            <li><a href="#preparation">Preparation</a></li>
        
            <li><a href="#steps-to-complete-this-tutorial">Steps To Complete This Tutorial</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="overview">Overview</h1>
<p>Background
Boundary offers an API so you can graph any measurable metric in realtime, however, there is a small amount of work involved in getting the metrics you are measuring to Boundary for display. To help solve this problem we introduced plugins.</p>
<p>A plugin is a tiny application that can be written in any language or script which simply reads the metric you are after and reports its value. The plugin is launched using the Plugin Manager which is built in to the meter, so no further installation is required.</p>
<p>Plugins not only make it very easy to add arbitrary metric monitoring to Boundary but because plugins are kept in a central, public, repository, they can be shared by all.</p>
<h2 id="preparation">Preparation</h2>
<p>Before starting on this tutorial it will be assumed that you have the prerequistes.  See <a href="../getting-started/prerequisites/">Prerequisites</a> for information on tools and other items required to start this tutorial.</p>
<h2 id="steps-to-complete-this-tutorial">Steps To Complete This Tutorial</h2>
<ol>
<li>Create Meter Plugin Contents</li>
<li>Install Meter Plugin Into Account
3.</li>
</ol>
<p>SCM tool - Github usually works in conjunction with a source code management tool installed on your system. For the purposes of this step-by-step we will assume this tool is git but the commands are so simple that you should not have any problem translating these steps for whichever tool you are using.
Step 1 - Define your Metric(s)</p>
<p>The first step in creating any plugin is deciding what metrics you want to track. In Boundary, the idea is that when a type of metric is created, it is given a universal name and is typically associated with a single plugin.</p>
<p>For the purposes of this step-by-step let’s create a plugin that will track CPU usage of individual CPU cores. The default CPU metric that the Boundary Agent collects is only the system wide average CPU so with this plugin we can now dive into individual CPU core usage information.</p>
<p>Creating the metric is simple:</p>
<p>Log into Boundary
Select Settings
Select Metrics
Select Create Metric</p>
<p>On this screen you are prompted to enter some information. Now for a quick word on metic identifiers. Metric identifiers must be globally unique so for the purpose of this step-by-step you will need to come up with a unique metric identifier. Try just appending your user name to CPU_CORE (ex: CPU_CORE_BOB99). If the name exists you will be told and you can change it.</p>
<p>Go ahead and enter the following:</p>
<p>Name: Per core CPU utilization
Short name: CPU Core
Identifier: CPU_CORE_… (the name you created above)
Description: Per core CPU utilization
Unit: Percentage
Default Aggregate: Average
Click Save and your new metric should show up in the list.
Note: A plugin can provide several metrics if desired</p>
<p>Step 2 - Create the plugin</p>
<p>Now the easy part, creating the actual plugin. As noted above all plugins are simply Github repositories so to start off we need to create a new repository. Log in to Github and click on New Repository</p>
<p>On the next screen you are asked for some information. Enter the following:</p>
<p>Repository name: boundary-plugin-cpu-core
Public: Yes
Initialize this repository with a README:
Add .gitignore: Node
Add a license: Apache v2 License
Now click Create repository.</p>
<p>At this point we have a new repository and Github has been kind enough to initialize it with some files. Let’s clone the repository locally. The easiest way to do this is to first copy the github URL to the clipboard by clicking the clipboard icon on right side of your new repository page.</p>
<p>Note: We have chosen SSH for this step-by-step</p>
<p>Now we just use git from the command line to bring it down:</p>
<p>$ git clone git@github.com:<your github username>/graphdat-plugin-cpu-core.git
Go into the folder..</p>
<p>$ cd graphdat-plugin-cpu-core
..and create a new file called index.js. In this file paste the following code:</p>
<p>https://gist.githubusercontent.com/pdiemert/6979264/raw/gistfile1.js</p>
<p>For convenience, here is a copy/paste:</p>
<p>var _os = require('os');
var _source = _os.hostname();
var _interval = parseInt(process.argv[1]) || 1000;
var _last; function poll()
{
   var cpus = _os.cpus();
   for(var idx = 0; idx &lt; cpus.length; idx++)
   {
       var e = cpus[idx];
       e.total = 0;
       for(var t in e.times)
           e.total += e.times[t];
   }</p>
<p>if (_last)
       {
           for(var idx = 0; idx &lt; cpus.length; idx++)
           {
               var e = cpus[idx];
               var l = _last[idx];
               var user = (e.times.user - l.times.user) /
                          (e.total - l.total);</p>
<pre><code>           console.log('CPU_CORE %d %s-%d', user, _source, idx + 1);
       }
   }
   _last = cpus;
   setTimeout(poll, _interval);
</code></pre>
<p>}</p>
<p>poll();
In the code above we used CPU_CORE as the metric name. You should replace this with the metric name you created from above.</p>
<p>Note: Although not applicable in this step-by-step, you may choose to pass configuration information to your plugin for testing purposes. To do this, simply create a file called param.json in this directory that contains a JSON object with the parameters/value pairs you require. During normal operation the Meter will overwrite this file with the settings that are chosen in the Settings / Meters / Plugins screen. See the section on paramSchema in the plugin documentation on how to define configuration parameters.</p>
<p>Now give your plugin a try from the command line..</p>
<p>$ node index.js
Now, assuming all is working up to this point, you should now be seeing some output of your CPU core percentages, reported once a second. That is all the coding you will need to do for this plugin! Press CTRL+C to stop the plugin.</p>
<p>Next, we need to create a description of this plugin. Create another file in the same directory called plugin.json. In this file paste the following:</p>
<p>{
 "description" : "Provides per core CPU utilization",
 "command" : "node index.js $(pollInterval)",
 "metrics" : ["CPU_CORE"]
}
As before, you should replace CPU_CORE with the name of your metric.</p>
<p>That’s it! You have created a minimal plugin. Before we can deploy it make sure to check it into Github:</p>
<hr />
<p>git add .
git commit -m “added source files”
git push</p>
<hr />
<p>Step 3 - Testing the deployment</p>
<p>Before submitting your plugin to Boundary for inclusion in the list of available plugins you will want to first test installing the plugin into your own account. At the command line:</p>
<hr />
<p>$ curl https://premium-api.boundary.com/v1/plugins/private/<plugin name>/<your github username>/<public plugin folder> -X PUT -u <your email>:<your API key></p>
<hr />
<p>You will now see the plugin listed when browsing all available plugins from Settings / Plugins / Get Plugins:</p>
<hr />
<hr />
<p>Click "Install" to add this plugin to your account. Next you will need to have installed the Boundary Meter on the machine you wish to monitor. The Meter will act as a Plugin Manager and communicate the measurements back to Boundary. If you need help installing the Meter these articles can help</p>
<p>You should now be able to see the Meter in your Settings / Meter tab. Click on the Meter to see the plugins it is running. Next click to add the cpu-core plugin:</p>
<hr />
<hr />
<p>Once you select the plugin you will be taken to the plugin configuration screen. We don’t need to change any settings so just click Save. As soon as you save the plugin configuration you will next be shown the Meter console. If we wait a few moments we will see the Meter install the Plugin:</p>
<hr />
<hr />
<p>The plugin is now running! For this step-by-step we have chosen not to add a new dashboard, instead, we'll add the metric graph to our dashboard using the dashboard editor.</p>
<p>Open the dashboard editor, it's the pencil icon in the main menu
Notice that in the toolbox we can see our new metric
Drag and drop this metric onto the dashboard and click Save
Done. On your dashboard you should now be seeing the per-core CPU performance being graphed!</p>
<p>If you were building your own plugin you’d probably be making further changes to the plugin before release. You can simply repeat the steps above (from the point of pushing your changes to github) and you will notice an ‘Apply update’ link next to the plugin from the Settings / Meters / (Meter) tab.</p>
<p>Step 4 - Submit to Boundary</p>
<p>When you are happy with your plugin and are ready to submit it to Boundary for inclusion in the public repository just follow the steps outlined in the plugin documentation to create a Github pull request. Once submitted, we'll review your plugin quickly and soon everyone will be able to enjoy your shiny new Boundary plugin!</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>